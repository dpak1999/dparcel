{% extends 'courier/base.html' %}

{% block head %}
<script src="https://maps.googleapis.com/maps/api/js?key={{G_M_KEY}}&callback=initMap&v=weekly" async></script>

<script>
  function initMap() {
    const map = new google.maps.Map(
      document.getElementById("map"),
      {
        zoom: 13,
        center: { lat: 41.85, lng: -87.65 },
      }
    );

    fetch("{% url 'courier:available_jobs_api' %}")
      .then(res => res.json())
      .then(json => {
        for (let i = 0; i < json.jobs.length; i++) {
          const job = json.jobs[i]
          const position = { lat: job.pickup_lat, lng: job.pickup_lng }
          const marker = new google.maps.Marker({
            position,
            map
          })

          new google.maps.InfoWindow({
            content: `<small><strong>${job.name}</strong></small><br /><small>${job.distance} Km</small>`
          }).open(map, marker)
        }
      })
  }
</script>

<style>
  #map {
    flex: 1;
  }

  .gm-ui-hover-effect {
    display: none !important;
  }
</style>
{% endblock %}

{% block content %}

<div class="d-flex flex-column h-100" style="padding-bottom: 60px;">
  <div id="map"></div>
</div>

{% include 'courier/bottom_tabs.html' %}
{% endblock %}